import User from "../structs/User";
import {rawDatabase, readDatabase, writeDatabase} from "./database";
import Server from "../structs/Server";
import UserAssets from "../structs/UserAssets";

const getUser = async (id): Promise<User> => {
    return new Promise((res)=>{
        readDatabase("users",id).then(async (user: User) => {
            const assets = await getUserAssets(id);
            Object.keys(assets).forEach(x => {
                user[x] = assets[x];
            });
            res(user === null ? await createUser(id) : user as User);
        });
    });
};

const getUserAssets = async (id): Promise<UserAssets> => {
    return new Promise((res)=>{
        readDatabase("images",id).then(async assets => {
            if(assets === null){
                await writeDatabase("images",id,{id});
                assets = {
                    id,
                    avatar: "data:image/png;base64,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",
                    banner: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABLAAAALQAQAAAACofrQCAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAd2KE6QAAAAHdElNRQfnBBUEMQ5zPgKeAAAAgElEQVR42u3BMQEAAADCoPVPbQsvoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHgYqL8AAVrCoDgAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDQtMjFUMDQ6NDk6MTQrMDA6MDASSNFVAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA0LTIxVDA0OjQ5OjE0KzAwOjAwYxVp6QAAAABJRU5ErkJggg=="
                };
            }
            res(assets as UserAssets);
        });
    });
};

const getUserCount = async (): Promise<number> =>{
    return new Promise(async res => {
        let count = -1; //Due to system account being listed as well
        for await (const [key, value] of rawDatabase("users")!.iterator()) {
            count++;
        }
        res(count);
    });
}

const createUser = async (id): Promise<User> => {
    return new Promise(async (res, rej)=>{
        const exists = await readDatabase("users", id).catch(e => console.log(e));
        if(exists !== null) rej("USER_EXISTS");
        const user = {
            ID: id,
            username: "Nya",
            discriminator: await findFreeDiscriminator("Nya"),
            role: "MEMBER",
            createdAt: Date.now().toString(),
            servers: ["0"]
        };
        await writeDatabase("users", id, user);
        const assets = await getUserAssets(id);
        Object.keys(assets).forEach(x => {
            user[x] = assets[x];
        });
        await readDatabase("servers","0").then(async (srv: Server) => {
            srv.members.push(id);
            await writeDatabase("servers","0",srv);
        });
        res(user as User);
    });
};

const findFreeDiscriminator = (name) => {
    return new Promise(async res => {
        let newDisc = Math.floor(1000 + Math.random() * 9000);
        for await (const [key, value] of rawDatabase("users")!.iterator()) {
            if(value.name === name){
                if(value.discriminator === newDisc) return res(findFreeDiscriminator(name));
            }
        }
        return res(newDisc);
    });
}

export {
    getUser,
    getUserCount,
    getUserAssets
}